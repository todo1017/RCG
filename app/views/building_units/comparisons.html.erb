<p id="notice"><%= notice %></p>

<h2>Market Comparison Report</h2>

<br>
<%= form_tag "/comparisons", :method => 'get' do %>
    <%= select_tag(:geography_filter, options_from_collection_for_select(Geography.all, :id, :name, params[:geography_filter])) %>
    &nbsp;
    <%= select_tag(:vacancy_filter, options_for_select([['Current vacant', 1], ['Lease ending in the next 30 days', 2], ['Lease ending in the next 60 days', 3], ['Lease ending in the next 90 days', 4], ['Lease ending in the next 120 days', 5]], params[:vacancy_filter])) %>
    &nbsp;
    <%= submit_tag "Filter", {:class=>"btn btn-success"} %>
<% end %>


<div class="scroll-table-div">

  <table class="scroll-table_comps">
    <thead>
    <tr>
      <th class="width-175"></th>
      <th class="width-225"></th>
      <th class="width-100">Available<br><br></th>
      <th class="width-100">Market Rent<br><br></th>
      <th class="width-100">Concessions<br><br></th>
      <th class="width-75">gross/ft2<br><br></th>
      <th class="width-75">net/ft2<br><br></th>
      <%- last_comp_group = "" %>
      <%- CompGroup.all.each do |comp_group| %>
        <%- Building.where(competitor: true, comp_group_id: comp_group.id, geography_id: @geography_id).each do |comp_building| %>
            <th class="width-250 grey-td table-top">
                <%= raw "<span class='uppercase'>" + comp_group.name + "</span>" if comp_group.name != last_comp_group %>
                <br>
                <%= comp_building.name %>
                <br><br>
                <table><tr><td class="first-col">
                    Actual Rent
                </td><td class="second-col">
                    gross/ft2
                </td><td class="third-col">
                    net/ft2
                    <br><br>
                </td></tr></table>
            </th>
            <% last_comp_group = comp_group.name %>
        <% end %>
      <% end %>
    </tr>
    </thead>

    <tbody>
    <% @building_units.each do |building_unit| %>
        <tr>
          <td class="width-175"><%= link_to building_unit.building.name + " #" + building_unit.number, edit_building_unit_path(building_unit) %></td>
          <td class="width-225"><%= unit_type(building_unit) %></td>
          <td class="width-100"><%= available(building_unit) %></td>
          <td class="width-100"><%= building_unit.market_rent %></td>
          <td class="width-100"><%= concessions_calc(building_unit, "owned") %></td>
          <td class="width-75"><%= gross_sq_foot(building_unit) %></td>
          <td class="width-75"><%= net_sq_foot(building_unit) %></td>
            <%- CompGroup.all.each do |comp_group| %>
              <%- Building.where(competitor: true, comp_group_id: comp_group.id, geography_id: @geography_id).each do |comp_building| %>
                  <td class="width-250 grey-td">
                    <% comps_query_1(building_unit, comp_building.id).each do |comp| %>
                        <b><%= render partial: "mouseover", locals: {comp: comp} %></b>
                    <% end.empty? and begin %>
                        nothing exact<br>
                    <% end %>
                    <% comps_query_2(building_unit, comp_building.id).each do |comp| %>
                      <%= render partial: "mouseover", locals: {comp: comp} %>
                    <% end %>
                    <br>
                  </td>
              <% end %>
            <% end %>
        </tr>
    <% end %>
    </tbody>
  </table>

</div>

<br>

<%= link_to "Download in Excel", comparisons_path(format: "xls") %>
<br>
<br>

